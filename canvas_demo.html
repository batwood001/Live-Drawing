<!DOCTYPE HTML>
<html>
<head>
</head>
<body>
<ul class="demoToolList">
	<li>
	<span class="highlight">Choose a color: </span>
	<button id="choosePurpleSimpleColors" type="button">Purple</button>
	<button id="chooseGreenSimpleColors" type="button">Green</button>
	<button id="chooseYellowSimpleColors" type="button">Yellow</button>
	<button id="chooseBrownSimpleColors" type="button">Brown</button>
	</li>
</ul>
<div id="canvasDiv"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>

	var socket = io('http://localhost');

	var canvasDiv = document.getElementById('canvasDiv');
	canvas = document.createElement('canvas');
	canvas.setAttribute('width', '1400'); // change all of this in CSS later
	canvas.setAttribute('height', "800");
	canvas.setAttribute('id', 'canvas');
	canvasDiv.appendChild(canvas);
	if(typeof G_vmlCanvasManager != 'undefined') {
		canvas = G_vmlCanvasManager.initElement(canvas);
	}
	context = canvas.getContext("2d");

	var selfBuffer = [];
	var otherBuffer = [];

	$('#canvas').mousedown(function(e){
	  var downPoint = {}
	  downPoint.mouseX = e.pageX - this.offsetLeft;
	  downPoint.mouseY = e.pageY - this.offsetTop;

	  socket.emit('mousedown', {'mouseX': mouseX, 'mouseY': mouseY, 'dragging': true})
			
	  paint = true;
	  addClick(mouseX, mouseY);
	  redraw();
	});

	$('#canvas').mousemove(function(e){
	  if(paint){
	  	var mouseX = e.pageX - this.offsetLeft;
	  	var mouseY = e.pageY - this.offsetTop;
	  	socket.emit('mousemove', {'mouseX': mouseX, 'mouseY': mouseY, 'dragging': true})
	    addClick(e.pageX - this.offsetLeft, e.pageY - this.offsetTop, true);
	    redraw();
	  }
	});

	$('#canvas').mouseup(function(e){
		socket.emit('mouseup', true)
  		paint = false;
	});

	$('#canvas').mouseleave(function(e){
  	paint = false;
	});

	// var clickX = new Array();
	// var clickY = new Array();
	// var clickDrag = new Array();
	// var paint;

	var colorPurple = "#cb3594";
	var colorGreen = "#659b41";
	var colorYellow = "#ffcf33";
	var colorBrown = "#986928";

	var curColor = colorPurple;
	var clickColor = new Array();

	$("#choosePurpleSimpleColors").click(function(){
		curColor = colorPurple;
	})

	$("#chooseGreenSimpleColors").click(function(){
		curColor = colorGreen
	})

	$("#chooseYellowSimpleColors").click(function(){
		curColor = colorYellow
	})

	$("#chooseBrownSimpleColors").click(function(){
		curColor = colorBrown
	})

	function addClick(x, y, dragging)
	{
	  clickX.push(x);
	  clickY.push(y);
	  clickDrag.push(dragging);
	  clickColor.push(curColor);
	}

	function redraw(){
  /* context.strokeStyle = "#df4b26"; */
	  context.lineJoin = "round";
	  context.lineWidth = 5;
				
	  for(var i=0; i < clickX.length; i++)
	  {		
	    context.beginPath();
	    if(clickDrag[i] && i){
	      context.moveTo(clickX[i-1], clickY[i-1]);
	    }else{
	      context.moveTo(clickX[i]-1, clickY[i]);
	    }
	    context.lineTo(clickX[i], clickY[i]);
	    context.closePath();
	    context.strokeStyle = clickColor[i];
	    context.stroke();
	  }
	}

	socket.on('mousedown', function (data) {
		console.log(data);
		addClick(data.mouseX, data.mouseY, data.paint);
		otherPaint = true;
		redraw();
	})

	socket.on('mousemove', function (data) {
		if(otherPaint){
		console.log(data);
		addClick(data.mouseX, data.mouseY, data.paint);
		redraw();
		}
	})

	socket.on('mouseup', function () {
		otherPaint = false
	}) 

</script>
</body>
